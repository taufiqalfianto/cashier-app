# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.
name: Flutter CI/CD to Firebase

on:
  push:
    branches: [main]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ”„ Checkout repository
      uses: actions/checkout@v3

    - name: ğŸ”§ Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.32.0'

    - name: ğŸ“¦ Install dependencies
      run: flutter pub get

    - name: ğŸ› ï¸ Build APK
      run: flutter build apk --release

    - name: ğŸ“ Generate release notes from last 5 commits
      id: release_notes
      run: |
        echo "RELEASE_NOTES<<EOF" >> $GITHUB_ENV
        git log -n 5 --pretty=format:"â€¢ %s" >> $GITHUB_ENV
        echo "EOF" >> $GITHUB_ENV

    - name: ğŸš€ Deploy to Firebase App Distribution
      uses: wzieba/Firebase-Distribution-Github-Action@v1
      with:
        appId: ${{ secrets.FIREBASE_APP_ID }}
        token: ${{ secrets.FIREBASE_TOKEN }}
        groups: internal-testers
        file: build/app/outputs/flutter-apk/app-release.apk
        releaseNotes: ${{ env.RELEASE_NOTES }}



# name: Dart

# on:
#   push:
#     branches: [ "main" ]

# jobs:
#   build:
#     runs-on: ubuntu-latest

#     steps:
#       - uses: actions/checkout@v4
      
#       - uses: dart-lang/setup-dart@9a04e6d73cca37bd455e0608d7e5092f881fd603

#       - name: Install dependencies
#         run: dart pub get

#       - name: ğŸ“¦ Install dependencies
#         run: flutter pub get
      
#       - name: ğŸ› ï¸ Build APK
#         run: flutter build apk --release
      
#       - name: ğŸš€ Deploy to Firebase App Distribution
#         uses: wzieba/Firebase-Distribution-Github-Action@v1
#         with:
#           appId: ${{ 1:486963806775:android:d828c9a36db71fbf1375b2 }}   # dapat dari Firebase Console
#           token: ${{ 0gJ5Sw54NICGxCgYIARAAGBASNwF-L9IrmNlvQ0kuLiYYxzW-NpUVRP9LiJPKqHedOVSVCT9et3ypQyjK_RYXSYeNerC10b2hk34 }}
#           groups: internal-testers                 # nama grup tester
#           file: build/app/outputs/flutter-apk/app-release.apk


